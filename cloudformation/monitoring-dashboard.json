{
  "widgets": [
    {
      "type": "metric",
      "x": 0,
      "y": 0,
      "width": 24,
      "height": 1,
      "properties": {
        "markdown": "# NOAA Federated Data Lake - System Health Dashboard\n**Account:** 899626030376 | **Environment:** dev | **Region:** us-east-1"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 1,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Invocations", { "stat": "Sum", "label": "Atmospheric", "color": "#1f77b4" }, { "id": "m1", "visible": true, "yAxis": "left" } ],
          [ "...", { "stat": "Sum", "label": "Oceanic", "color": "#ff7f0e" } ],
          [ "...", { "stat": "Sum", "label": "Buoy", "color": "#2ca02c" } ],
          [ "...", { "stat": "Sum", "label": "Climate", "color": "#d62728" } ],
          [ "...", { "stat": "Sum", "label": "Terrestrial", "color": "#9467bd" } ],
          [ "...", { "stat": "Sum", "label": "Spatial", "color": "#8c564b" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "Lambda Invocations by Pond",
        "period": 300,
        "yAxis": {
          "left": {
            "showUnits": false,
            "label": "Invocations"
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 1,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Errors", { "stat": "Sum", "label": "Atmospheric Errors", "color": "#d62728" } ],
          [ "...", { "stat": "Sum", "label": "Oceanic Errors", "color": "#d62728" } ],
          [ "...", { "stat": "Sum", "label": "Buoy Errors", "color": "#d62728" } ],
          [ "...", { "stat": "Sum", "label": "Climate Errors", "color": "#d62728" } ],
          [ "...", { "stat": "Sum", "label": "Terrestrial Errors", "color": "#d62728" } ],
          [ "...", { "stat": "Sum", "label": "Spatial Errors", "color": "#d62728" } ]
        ],
        "view": "timeSeries",
        "stacked": true,
        "region": "us-east-1",
        "title": "Lambda Errors",
        "period": 300,
        "yAxis": {
          "left": {
            "showUnits": false,
            "label": "Errors",
            "min": 0
          }
        },
        "annotations": {
          "horizontal": [
            {
              "label": "Error Threshold",
              "value": 5,
              "fill": "above",
              "color": "#d62728"
            }
          ]
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 7,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Duration", { "stat": "Average", "label": "Atmospheric Avg" } ],
          [ "...", { "stat": "Average", "label": "Oceanic Avg" } ],
          [ "...", { "stat": "Average", "label": "Buoy Avg" } ],
          [ "...", { "stat": "Average", "label": "Climate Avg" } ],
          [ "...", { "stat": "Average", "label": "Terrestrial Avg" } ],
          [ "...", { "stat": "Average", "label": "Spatial Avg" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "Lambda Execution Duration",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "Milliseconds",
            "showUnits": false
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 8,
      "y": 7,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "ConcurrentExecutions", { "stat": "Maximum", "label": "Max Concurrent" } ],
          [ ".", "Throttles", { "stat": "Sum", "label": "Throttles", "yAxis": "right" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "Lambda Concurrency & Throttles",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "Concurrent Executions",
            "showUnits": false
          },
          "right": {
            "label": "Throttles",
            "showUnits": false
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 16,
      "y": 7,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ { "expression": "m1/m2*100", "label": "Success Rate %", "id": "e1", "yAxis": "left", "color": "#2ca02c" } ],
          [ "AWS/Lambda", "Invocations", { "stat": "Sum", "id": "m1", "visible": false } ],
          [ ".", "Errors", { "stat": "Sum", "id": "m2", "visible": false } ]
        ],
        "view": "singleValue",
        "region": "us-east-1",
        "title": "Overall Success Rate (Last Hour)",
        "period": 3600,
        "setPeriodToTimeRange": false,
        "sparkline": true,
        "trend": true
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 13,
      "width": 24,
      "height": 1,
      "properties": {
        "markdown": "## Data Ingestion Metrics"
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 14,
      "width": 12,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/lambda/noaa-ingest-atmospheric-dev'\n| SOURCE '/aws/lambda/noaa-ingest-oceanic-dev'\n| SOURCE '/aws/lambda/noaa-ingest-buoy-dev'\n| SOURCE '/aws/lambda/noaa-ingest-climate-dev'\n| SOURCE '/aws/lambda/noaa-ingest-terrestrial-dev'\n| SOURCE '/aws/lambda/noaa-ingest-spatial-dev'\n| fields @timestamp, @message\n| filter @message like /Successfully wrote/\n| stats count() by bin(5m)",
        "region": "us-east-1",
        "stacked": false,
        "title": "Successful Data Writes (5min buckets)",
        "view": "timeSeries"
      }
    },
    {
      "type": "log",
      "x": 12,
      "y": 14,
      "width": 12,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/lambda/noaa-ingest-atmospheric-dev'\n| SOURCE '/aws/lambda/noaa-ingest-oceanic-dev'\n| SOURCE '/aws/lambda/noaa-ingest-buoy-dev'\n| SOURCE '/aws/lambda/noaa-ingest-climate-dev'\n| SOURCE '/aws/lambda/noaa-ingest-terrestrial-dev'\n| SOURCE '/aws/lambda/noaa-ingest-spatial-dev'\n| fields @timestamp, @message\n| filter @message like /ERROR/ or @message like /Exception/ or @message like /Failed/\n| stats count() by bin(5m)",
        "region": "us-east-1",
        "stacked": false,
        "title": "Errors in Logs (5min buckets)",
        "view": "timeSeries"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 20,
      "width": 24,
      "height": 1,
      "properties": {
        "markdown": "## S3 Storage Metrics"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 21,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/S3", "BucketSizeBytes", { "stat": "Average", "label": "Data Lake Size", "period": 86400 } ],
          [ "...", { "stat": "Average", "label": "Athena Results", "period": 86400 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "S3 Bucket Size (Daily)",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "Bytes",
            "showUnits": true
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 21,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/S3", "NumberOfObjects", { "stat": "Average", "label": "Total Objects", "period": 86400 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "S3 Object Count (Daily)",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "Objects",
            "showUnits": false
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 27,
      "width": 24,
      "height": 1,
      "properties": {
        "markdown": "## EventBridge & Scheduling"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 28,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Events", "Invocations", { "stat": "Sum", "label": "Atmospheric Rule" } ],
          [ "...", { "stat": "Sum", "label": "Oceanic Rule" } ],
          [ "...", { "stat": "Sum", "label": "Buoy Rule" } ],
          [ "...", { "stat": "Sum", "label": "Climate Rule" } ],
          [ "...", { "stat": "Sum", "label": "Terrestrial Rule" } ],
          [ "...", { "stat": "Sum", "label": "Spatial Rule" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "EventBridge Rule Invocations",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "Invocations",
            "showUnits": false
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 28,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Events", "FailedInvocations", { "stat": "Sum", "label": "Failed Invocations", "color": "#d62728" } ],
          [ ".", "ThrottledRules", { "stat": "Sum", "label": "Throttled Rules", "color": "#ff7f0e" } ]
        ],
        "view": "timeSeries",
        "stacked": true,
        "region": "us-east-1",
        "title": "EventBridge Failures & Throttles",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "Count",
            "showUnits": false,
            "min": 0
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 34,
      "width": 24,
      "height": 1,
      "properties": {
        "markdown": "## Athena Query Performance"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 35,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Athena", "DataScannedInBytes", { "stat": "Sum", "label": "Data Scanned", "period": 3600 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "Athena Data Scanned (Hourly)",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "Bytes",
            "showUnits": true
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 35,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Athena", "EngineExecutionTime", { "stat": "Average", "label": "Avg Query Time" } ],
          [ "...", { "stat": "Maximum", "label": "Max Query Time" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "Athena Query Execution Time",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "Milliseconds",
            "showUnits": false
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 41,
      "width": 24,
      "height": 1,
      "properties": {
        "markdown": "## System Health Indicators"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 42,
      "width": 6,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Invocations", { "stat": "Sum", "label": "Total Invocations" } ]
        ],
        "view": "singleValue",
        "region": "us-east-1",
        "title": "Total Lambda Invocations (1hr)",
        "period": 3600,
        "setPeriodToTimeRange": false,
        "sparkline": true,
        "trend": true
      }
    },
    {
      "type": "metric",
      "x": 6,
      "y": 42,
      "width": 6,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Errors", { "stat": "Sum", "label": "Total Errors", "color": "#d62728" } ]
        ],
        "view": "singleValue",
        "region": "us-east-1",
        "title": "Total Errors (1hr)",
        "period": 3600,
        "setPeriodToTimeRange": false,
        "sparkline": true,
        "trend": true
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 42,
      "width": 6,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Duration", { "stat": "Average", "label": "Avg Duration" } ]
        ],
        "view": "singleValue",
        "region": "us-east-1",
        "title": "Avg Execution Time (1hr)",
        "period": 3600,
        "setPeriodToTimeRange": false,
        "sparkline": true,
        "trend": true
      }
    },
    {
      "type": "metric",
      "x": 18,
      "y": 42,
      "width": 6,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "ConcurrentExecutions", { "stat": "Maximum", "label": "Max Concurrency" } ]
        ],
        "view": "singleValue",
        "region": "us-east-1",
        "title": "Peak Concurrency (1hr)",
        "period": 3600,
        "setPeriodToTimeRange": false,
        "sparkline": true,
        "trend": true
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 48,
      "width": 24,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/lambda/noaa-ingest-atmospheric-dev'\n| SOURCE '/aws/lambda/noaa-ingest-oceanic-dev'\n| SOURCE '/aws/lambda/noaa-ingest-buoy-dev'\n| SOURCE '/aws/lambda/noaa-ingest-climate-dev'\n| SOURCE '/aws/lambda/noaa-ingest-terrestrial-dev'\n| SOURCE '/aws/lambda/noaa-ingest-spatial-dev'\n| fields @timestamp, @logStream, @message\n| filter @message like /ERROR/ or @message like /Exception/ or @message like /Failed/\n| sort @timestamp desc\n| limit 50",
        "region": "us-east-1",
        "stacked": false,
        "title": "Recent Errors (Last 50)",
        "view": "table"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 54,
      "width": 24,
      "height": 1,
      "properties": {
        "markdown": "## Cost Estimation (Approximate)\n**Note:** CloudWatch does not provide real-time cost metrics. Use AWS Cost Explorer for accurate costs."
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 55,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ { "expression": "m1*0.0000002", "label": "Estimated Lambda Cost ($)", "id": "e1", "yAxis": "left" } ],
          [ "AWS/Lambda", "Invocations", { "stat": "Sum", "id": "m1", "visible": false, "period": 86400 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "Estimated Daily Lambda Cost",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "USD",
            "showUnits": false
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 55,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ { "expression": "m1*0.000005/1024/1024/1024", "label": "Estimated Athena Cost ($)", "id": "e1", "yAxis": "left" } ],
          [ "AWS/Athena", "DataScannedInBytes", { "stat": "Sum", "id": "m1", "visible": false, "period": 86400 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "us-east-1",
        "title": "Estimated Daily Athena Query Cost",
        "period": 300,
        "yAxis": {
          "left": {
            "label": "USD",
            "showUnits": false
          }
        }
      }
    }
  ]
}
