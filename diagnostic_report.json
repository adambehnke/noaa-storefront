{
  "report_metadata": {
    "generated_at": "2025-12-09T16:38:30Z",
    "environment": "dev",
    "aws_account": "899626030376",
    "analysis_period_days": 14,
    "report_version": "1.0"
  },
  "overall_status": {
    "health": "PARTIALLY_OPERATIONAL",
    "health_score": 45,
    "critical_issues_count": 3,
    "high_priority_issues_count": 3,
    "medium_priority_issues_count": 2
  },
  "data_ponds": {
    "total": 6,
    "active": 3,
    "inactive": 3,
    "status_by_pond": {
      "atmospheric": {
        "status": "ACTIVE",
        "endpoints_active": 2,
        "endpoints_total": 4,
        "bronze_files": 177,
        "bronze_size_mb": 12.11,
        "gold_files": 2,
        "gold_size_kb": 8.35,
        "last_update": "2025-11-19T12:34:53Z",
        "days_since_update": 20,
        "endpoints": {
          "observations": {"status": "ACTIVE", "files": 59, "stations": 6},
          "alerts": {"status": "ACTIVE", "files": 59},
          "forecasts": {"status": "INACTIVE"},
          "stations": {"status": "INACTIVE"}
        }
      },
      "oceanic": {
        "status": "ACTIVE",
        "endpoints_active": 2,
        "endpoints_total": 4,
        "bronze_files": 26,
        "bronze_size_mb": 0.84,
        "gold_files": 9,
        "gold_size_kb": 3.60,
        "last_update": "2025-11-06T16:12:06Z",
        "days_since_update": 33,
        "endpoints": {
          "water_temperature": {"status": "ACTIVE", "files": 10, "stations": 6},
          "water_level": {"status": "ACTIVE", "files": 16},
          "wind": {"status": "INACTIVE"},
          "currents": {"status": "INACTIVE"}
        }
      },
      "buoy": {
        "status": "ACTIVE_LIMITED",
        "endpoints_active": 1,
        "endpoints_total": 3,
        "bronze_files": 1,
        "bronze_size_mb": 1.58,
        "gold_files": 2,
        "gold_size_kb": 1.39,
        "last_update": "2025-11-13T09:35:07Z",
        "days_since_update": 26,
        "endpoints": {
          "realtime_data": {"status": "ACTIVE", "files": 1, "stations": 1}
        }
      },
      "climate": {
        "status": "INACTIVE",
        "endpoints_active": 0,
        "endpoints_total": 3,
        "bronze_files": 0,
        "bronze_size_mb": 0,
        "gold_files": 1,
        "gold_size_kb": 0.99,
        "reason": "API token required but not configured"
      },
      "terrestrial": {
        "status": "INACTIVE",
        "endpoints_active": 0,
        "endpoints_total": 3,
        "bronze_files": 0,
        "bronze_size_mb": 0,
        "gold_files": 0,
        "gold_size_kb": 0,
        "reason": "Lambda function not deployed"
      },
      "spatial": {
        "status": "INACTIVE",
        "endpoints_active": 0,
        "endpoints_total": 2,
        "bronze_files": 0,
        "bronze_size_mb": 0,
        "gold_files": 0,
        "gold_size_kb": 0,
        "reason": "Lambda function not deployed"
      }
    }
  },
  "endpoints": {
    "total_configured": 25,
    "total_active": 6,
    "coverage_percent": 24,
    "active_endpoints": [
      "api.weather.gov/stations/*/observations",
      "api.weather.gov/alerts/active",
      "tidesandcurrents.noaa.gov/api/prod/datagetter?product=water_temperature",
      "tidesandcurrents.noaa.gov/api/prod/datagetter?product=water_level",
      "www.ndbc.noaa.gov/data/realtime2/{station}",
      "www.ndbc.noaa.gov/data/stations/"
    ],
    "inactive_endpoints": [
      "api.weather.gov/gridpoints/{office}/{gridX},{gridY}/forecast",
      "api.weather.gov/stations",
      "tidesandcurrents.noaa.gov/api/prod/datagetter?product=wind",
      "tidesandcurrents.noaa.gov/api/prod/datagetter?product=currents",
      "ncdc.noaa.gov/cdo-web/api/v2/data",
      "ncdc.noaa.gov/cdo-web/api/v2/stations",
      "waterservices.usgs.gov/nwis/iv/",
      "waterservices.usgs.gov/nwis/dv/",
      "api.weather.gov/radar/stations",
      "api.weather.gov/radar/servers"
    ]
  },
  "medallion_architecture": {
    "bronze": {
      "status": "OPERATIONAL",
      "total_files": 204,
      "total_size_mb": 14.53,
      "ponds_with_data": 3,
      "data_quality": "GOOD",
      "issues": []
    },
    "silver": {
      "status": "NOT_IMPLEMENTED",
      "total_files": 0,
      "total_size_mb": 0,
      "ponds_with_data": 0,
      "issue": "Layer completely unused - documented in architecture but not implemented"
    },
    "gold": {
      "status": "PARTIALLY_OPERATIONAL",
      "total_files": 14,
      "total_size_kb": 14.33,
      "ponds_with_data": 4,
      "compression_ratio_percent": 0.10,
      "issue": "99.9% data loss from Bronze, unclear transformation logic"
    },
    "transformation_pipeline": {
      "current": "Bronze -> Gold (direct, skips Silver)",
      "expected": "Bronze -> Silver -> Gold",
      "gap": "Silver layer not implemented"
    }
  },
  "lambda_functions": {
    "total_deployed": 0,
    "total_expected": 7,
    "deployment_status": "CRITICAL_ALL_MISSING",
    "missing_functions": [
      "noaa-ingest-atmospheric-dev",
      "noaa-ingest-oceanic-dev",
      "noaa-ingest-buoy-dev",
      "noaa-ingest-climate-dev",
      "noaa-ingest-terrestrial-dev",
      "noaa-ingest-spatial-dev",
      "noaa-ai-query-dev"
    ],
    "eventbridge_rules": {
      "total": 19,
      "enabled": 19,
      "status": "All rules enabled but targeting non-existent functions"
    }
  },
  "ai_query_handler": {
    "status": "NOT_DEPLOYED",
    "lambda_deployed": false,
    "api_gateway_configured": false,
    "cloudfront_configured": false,
    "bedrock_permissions": false,
    "impact": "Natural language queries unavailable, web interface non-functional"
  },
  "data_freshness": {
    "overall_status": "STALE",
    "oldest_update_days": 33,
    "newest_update_days": 20,
    "ponds_with_stale_data": 3,
    "last_ingestion": "2025-11-19T12:34:53Z"
  },
  "critical_issues": [
    {
      "id": 1,
      "severity": "CRITICAL",
      "title": "All Lambda Functions Deleted",
      "description": "0 of 7 expected Lambda functions are deployed. EventBridge rules are configured but targeting non-existent functions.",
      "impact": "No new data ingestion occurring, system frozen at November 19, 2025 data",
      "affected_components": ["All data ponds", "EventBridge", "Data ingestion pipeline"],
      "fix": "Redeploy all Lambda functions using: ./scripts/package_all_lambdas.sh --env dev --upload && ./scripts/deploy_to_aws.sh --env dev"
    },
    {
      "id": 2,
      "severity": "CRITICAL",
      "title": "Data is 20-33 Days Stale",
      "description": "No data updates in past 20-33 days across all active ponds. Atmospheric (20d), Oceanic (33d), Buoy (26d).",
      "impact": "System providing severely outdated environmental data, defeating purpose of real-time monitoring",
      "affected_components": ["All data ponds", "End users", "Data quality"],
      "fix": "Restore Lambda functions and consider backfill for missing dates"
    },
    {
      "id": 3,
      "severity": "CRITICAL",
      "title": "AI Query Handler Not Operational",
      "description": "Core documented feature (natural language queries) is not deployed. Lambda function, API Gateway, and web interface are all missing.",
      "impact": "Users cannot query data lake via natural language, primary user interface unusable",
      "affected_components": ["AI query handler", "API Gateway", "Web interface", "User experience"],
      "fix": "Deploy AI query handler stack: aws cloudformation create-stack --stack-name noaa-ai-query-dev --template-body file://cloudformation/noaa-ai-query.yaml"
    }
  ],
  "high_priority_issues": [
    {
      "id": 4,
      "severity": "HIGH",
      "title": "Silver Layer Not Implemented",
      "description": "Documented medallion architecture includes Silver layer, but it is completely unused (0 files)",
      "impact": "No data cleaning, validation, or Parquet optimization. Athena queries will be slow on raw JSON.",
      "fix": "Implement Glue ETL jobs for Bronze -> Silver transformation with Parquet format"
    },
    {
      "id": 5,
      "severity": "HIGH",
      "title": "50% of Ponds Inactive",
      "description": "Climate, Terrestrial, and Spatial ponds not ingesting any data",
      "impact": "Missing critical data types: climate history, river levels, radar/satellite imagery",
      "fix": "Climate: Configure CDO API token. Terrestrial/Spatial: Debug and redeploy Lambda functions"
    },
    {
      "id": 6,
      "severity": "HIGH",
      "title": "Athena Tables Not Created",
      "description": "Gold layer data exists but cannot be queried via Athena (no tables found)",
      "impact": "SQL queries impossible, federation queries blocked, analytics capabilities unavailable",
      "fix": "Run: aws athena start-query-execution with sql/create-all-gold-tables.sql"
    }
  ],
  "medium_priority_issues": [
    {
      "id": 7,
      "severity": "MEDIUM",
      "title": "Limited Endpoint Coverage",
      "description": "Only 6 of documented 25+ endpoints actively ingesting data (24% coverage)",
      "impact": "Incomplete data collection, missing forecasts, wind data, currents, multiple stations",
      "fix": "Review ingestion Lambda code, add missing endpoint logic, expand station coverage"
    },
    {
      "id": 8,
      "severity": "MEDIUM",
      "title": "Extreme Data Loss in Gold Layer",
      "description": "99.9% of Bronze data not present in Gold (0.1% retention)",
      "impact": "Unclear what data is accessible, potential loss of valuable information",
      "fix": "Document transformation logic, determine if aggressive summarization is intentional"
    }
  ],
  "recommendations": {
    "immediate": [
      "Redeploy all Lambda functions immediately",
      "Verify data ingestion resumes with fresh data",
      "Deploy AI query handler and API Gateway",
      "Configure NOAA CDO API token for Climate pond"
    ],
    "short_term": [
      "Implement Silver layer Glue ETL jobs with Parquet format",
      "Create Athena tables for Gold layer querying",
      "Expand endpoint coverage to missing APIs (forecasts, wind, currents)",
      "Add CloudWatch monitoring dashboards and SNS alerts",
      "Test natural language query interface end-to-end"
    ],
    "medium_term": [
      "Debug and complete Terrestrial pond (USGS data)",
      "Debug and complete Spatial pond (radar/satellite)",
      "Update documentation to match actual architecture",
      "Implement automated testing suite",
      "Set up operational runbooks and troubleshooting guides",
      "Review and optimize Gold layer transformation logic"
    ]
  },
  "cost_analysis": {
    "current_monthly_cost_usd": 0.05,
    "projected_monthly_cost_usd": 15.0,
    "breakdown": {
      "s3_storage": 0.004,
      "lambda_compute": 2.0,
      "eventbridge": 0.01,
      "athena_queries": 0.5,
      "bedrock_ai": 12.0
    },
    "primary_cost_drivers": [
      "Bedrock AI queries for natural language interface",
      "Lambda invocations (17K-52K/month when operational)",
      "S3 storage (minimal at current scale)"
    ]
  },
  "data_quality_summary": {
    "bronze_layer": {
      "format": "JSON",
      "partitioning": "date=YYYY-MM-DD",
      "timestamps": "ISO 8601 format",
      "metadata": "Station names and coordinates included",
      "issues": ["Many null values in observations", "No deduplication", "No schema enforcement"]
    },
    "gold_layer": {
      "format": "JSON (should be Parquet)",
      "coverage": "Minimal (0.1% of Bronze)",
      "issues": ["Unclear aggregation logic", "Extreme data loss", "No documentation"]
    }
  },
  "next_steps": {
    "week_1": [
      "Deploy Lambda functions",
      "Monitor first successful runs",
      "Fix Climate pond API token",
      "Test AI query handler"
    ],
    "week_2": [
      "Implement Silver layer ETL",
      "Create Athena tables",
      "Add missing endpoints",
      "Set up monitoring"
    ],
    "week_3_4": [
      "Complete remaining ponds",
      "Performance optimization",
      "Documentation updates",
      "User acceptance testing"
    ]
  }
}
